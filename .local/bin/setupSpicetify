#!/bin/sh
# WWW          : https://github.com/wwwsensor/dotfiles
# Author       : @sensor @ss
# Dependencies : paru
#
# Auto setup Spicetify.

N=/dev/null

# Handle errors
senderr(){ echo setupSpicetify: "$@";exit 1; }

# Handle dependencies
which paru >$N || senderr paru not found

# Select proper elevation method
which doas >$N && alias s=sudo || alias s=doas

# SW install
echo Installing Spotify...
paru --noconfirm -Sy spotify >$N 2>&1 || p spotify-snapstore >$N 2>&1
echo Installing Spicetify...
paru --noconfirm --needed -Sy spicetify-cli spicetify-marketplace-bin >$N 2>&1 &&

# Preparation
mkdir -p ~/.config/spotify && touch ~/.config/spotify/prefs &&

# Rights
echo Getting write rights of /opt/spotify ...
s chgrp wheel -R /opt/spotify >$N 2>&1 && s chown $USER -R /opt/spotify >$N 2>&1 &&

# Injection
echo Injecting Spicetify...
{ spicetify config custom_apps marketplace && spicetify backup apply; } >$N 2>&1
echo Finished!
