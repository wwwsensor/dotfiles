#!/bin/sh
# WWW          : https://github.com/wwwsensor/dotfiles
# Author       : @sensor @ss
# Dependencies : paru
#
# Post Dotfiles Manager script

# Notable variables
N=/dev/null

# Handle errors
senderr(){ echo dmpost: "$@";exit 1; }

# Handle dependencies
which paru >$N 2>&1 || senderr paru not found

# SW
sudo ln -sf $(which doas) /usr/bin/sudo
{
paru -S --needed --noconfirm doasedit-alternative opendoas
paru -Rn --noconfirm base-devel sudo
paru -S --needed --noconfirm cli11 automake autoconf gcc fakeroot make meson which guile ninja texinfo patch pkgconf m4
} >$N 2>&1

# Sys config
## zsh
which zsh >$N 2>&1 && {
  ZDIR=/etc/zsh
  STR="export ZDOTDIR=~/.config/zsh"
  mkdir -p $ZDIR
  touch $ZDIR/zshenv
  grep -q "$STR" $ZDIR/zshenv ||
  echo "$STR" | doas tee -a $ZDIR/zshenv >$N
}
